### 数学方法与模型说明

本文档概述项目中使用的主要数学方法、模型的数学公式，以及各变量和参数的含义，便于复现与进一步分析。实现细节请参见 `src/system_dynamics.py` 和 `src/optimization.py`。

## 一、问题概述（简要）

研究目标是在旅游活动、环境质量和社区福祉之间权衡，构建可供决策者选择的政策集合（Pareto 最优解集）。主要包含两类模型：
- **系统动力学模型（System Dynamics）**：刻画随时间演化的状态变量（例如环境质量、游客数量、经济产出等）。
- **多目标优化模型（Multi-objective Optimization）**：在给定模型和约束下寻找满足不同目标的政策/决策变量。

## 二、系统动力学模型（连续时间表述）

设状态向量为 \(x(t)\in\mathbb{R}^n\)，控制/决策向量为 \(u(t)\in\mathbb{R}^m\)，参数向量为 \(\theta\)。系统动力学一般写为常微分方程（ODE）：

\[
\frac{dx(t)}{dt} = f\big(x(t),\,u(t),\,\theta\big), \qquad x(0)=x_0
\]

其中：
- \(x(t)\)：状态变量（随时间变化的系统量），例如游客数 \(T(t)\)、环境质量 \(E(t)\)、社区福祉 \(W(t)\) 等。
- \(u(t)\)：可控决策（政策强度、入场配额、保护投资等）。
- \(\theta\)：模型参数（衰减率、恢复率、单游客影响系数等）。
- \(f(\cdot)\)：状态转移函数，由具体假设或经验模型给出，可能是线性或非线性函数。

示例（用于说明变量间关系的常见形式）：

\[
\begin{aligned}
\frac{dT}{dt} &= \rho_T(u) - \mu_T T \\
\frac{dE}{dt} &= -\alpha_E T + \beta_E R(E,u) - \mu_E E \\
\frac{dW}{dt} &= \gamma_W B(T,u) - \delta_W I(E,T)
\end{aligned}
\]

解释（示例）：
- \(\rho_T(u)\)：游客进入速率，受管理政策 \(u\) 影响（配额、价格等）。
- \(\mu_T\)：游客离开或流失率。
- \(\alpha_E\)：单个游客对环境的负面冲击系数。
- \(\beta_E R(E,u)\)：环境恢复项，\(\beta_E\) 为恢复效率，\(R(\cdot)\) 可能与保护投资或自然恢复相关。
- \(B(T,u)\)：经济收益函数（例如门票、消费），\(\gamma_W\) 为收益转化为社区福祉的系数。
- \(I(E,T)\)：环境退化或冲突导致的福利损失，\(\delta_W\) 为灵敏度系数。

注：实际代码中可将这些项离散化（显式欧拉或其他数值积分方法）以便仿真。

## 三、多目标优化模型（决策层）

目标通常为多个相互冲突的函数。例如希望**最大化经济收益**、**最大化社会福祉**、**最小化环境损害**。写成标准的多目标优化问题：

\[
\begin{aligned}
&\text{minimize/ maximize}_{u} \quad && \mathbf{J}(u) = \big(J_1(u), J_2(u), \dots, J_k(u)\big) \\
&\text{subject to} \quad && g_i\big(x(t;u), u, \theta\big) \le 0,\quad i=1,\dots,p, \\
& && x(t;u)\ \text{satisfies system dynamics on } t\in[0,T_f], \\
& && u \in \mathcal{U}\ \text{(可行集，如边界、整数约束等)}.
\end{aligned}
\]

常见目标举例（符号说明见下表）：
- \(J_1(u) = -\int_0^{T_f} B\big(T(t),u(t)\big)\,dt\)（如果把收益写成要最小化负收益）；  
- \(J_2(u) = \int_0^{T_f} I\big(E(t),T(t)\big)\,dt\)（累计环境损害）；  
- \(J_3(u) = -\int_0^{T_f} W(t)\,dt\)（负的累计社会福利，最小化即最大化福利）。

多目标求解方法（在实现中常见）：
- **加权和法（Weighted sum）**：选权重 \(w\)，求解 \(\min_u \sum_{j} w_j J_j(u)\) 来得到 Pareto 面上的点。
- **演化算法（如 NSGA-II、MOEA）**：直接寻找 Pareto 前沿的近似集。
- **目标分层/约束化方法**：将某些目标作为约束，优化主要目标。

定义 Pareto 最优解：若不存在另一可行解 \(u'\) 使得对所有目标 \(J_j(u')\le J_j(u)\) 且至少一项严格小，则称 \(u\) 为 Pareto 最优。

## 四、离散化与数值求解

- 将连续时间模型在时间网格 \(t_0,t_1,\dots,t_N\) 上离散化：\(x_{k+1}=x_k + \Delta t\cdot f(x_k,u_k,\theta)\)（显式欧拉），或使用更高阶积分器。
- 优化器在离散化后以有限维的决策向量 \(u_0,\dots,u_{N-1}\) 进行求解。
- 求解时需注意稳定性、时间步长 \(\Delta t\)、以及约束处理（惩罚/投影/拉格朗日等）。

## 五、常用符号与变量含义（示例表）

 - **状态变量**
   - \(T(t)\)：游客数量（人数）
   - \(E(t)\)：环境质量指数（无量纲或标准化分数，越大表示越好）
   - \(W(t)\)：社区/社会福祉指数

 - **决策变量 / 控制**
   - \(u(t)\)：管理策略向量（包含门票价格、入场配额、保护投资比例等）
   - 若为分阶段决策，使用 \(u_k\) 表示第 k 个时间段的固定决策

 - **模型参数**
   - \(\alpha_E\)：单个游客对环境的平均负面影响（环境单位/人/时间）
   - \(\beta_E\)：环境自然或人造恢复率系数（1/时间）
   - \(\mu_T\)：游客流失率（1/时间）
   - \(\gamma_W\)：经济收益转为社区福祉的转换系数
   - \(\delta_W\)：环境恶化对福利的削弱系数

 - **目标与约束**
   - \(B(T,u)\)：瞬时经济收益函数（货币/时间）
   - \(I(E,T)\)：瞬时环境损害函数（损害量/时间）
   - \(g_i(\cdot)\)：可行性约束（如最大承载量、预算、法规约束）

（根据项目中 `PARAMETER_GUIDE.md` 与 `PARAMETER_ADJUSTMENT_GUIDE.md` 的具体参数命名，可把上表映射为代码中的变量名）

## 六、不确定性与参数灵敏度

- 参数 \(\theta\) 通常有不确定性，可用蒙特卡罗采样评估方案鲁棒性：对 \(\theta\) 采样，运行系统-优化闭环，统计目标分布与Pareto解集的稳定性。
- 灵敏度分析可采用局部（偏导数、有限差分）或全局（Sobol 指数）方法，量化参数变动对目标的影响。

## 七、实现备注（与代码对应）

- 仿真器（forward model）实现：`src/system_dynamics.py`，负责从 \(u\) 与 \(\theta\) 生成 \(x(t)\) 时间序列与瞬时目标量。
- 优化器实现：`src/optimization.py`，负责封装目标函数、约束并调用优化算法（加权和、演化算法等）。
- 参数与实验设置：`sustainable_tourism_juneau/PARAMETER_GUIDE.md` 与 `PARAMETER_ADJUSTMENT_GUIDE.md`。

## 参考与扩展（建议）

- 若需严格数学推导，可把状态方程写为向量形式并线性化以便局部稳定性分析（雅可比矩阵与特征值分析）。
- 若目标与约束均为凸函数/集合，可使用凸优化工具得到全局最优解；否则需借助启发式/全局优化算法近似 Pareto 前沿。

---

若你需要我把上述内容调整为指定格式（如课堂讲义、报告节选），或把公式与代码实现中的具体变量名一一对应，请告诉我希望的文件名和风格，我会更新 `MATH_METHODS.md`。 

